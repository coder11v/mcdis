<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Server Status</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style for the MOTD from the API's HTML output */
        .motd-container span {
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="status-card" class="w-full max-w-md bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-700 transition-all duration-300">
        <!-- Header Section -->
        <div class="flex items-center justify-between mb-4">
            <h1 class="text-2xl font-bold text-gray-100">Server Status</h1>
            <button id="refresh-btn" class="text-gray-400 hover:text-white transition-transform duration-300">
                <svg id="refresh-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M20.49 9A9 9 0 0 0 7.24 4.56M3.51 15A9 9 0 0 0 16.76 19.44"></path></svg>
            </button>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="text-center py-8">
            <p class="text-gray-400">Fetching server data...</p>
        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden text-center py-8 bg-red-900/50 rounded-lg">
             <p id="error-message" class="text-red-300 font-medium"></p>
        </div>

        <!-- Content Section -->
        <div id="server-content" class="hidden">
            <!-- Server Info Header -->
            <div class="flex items-start space-x-4 mb-5">
                <img id="server-icon" src="https://placehold.co/64x64/1F2937/FFFFFF?text=ICON" alt="Server Icon" class="w-16 h-16 rounded-lg bg-gray-700">
                <div>
                    <p class="text-lg font-semibold text-gray-200" id="server-hostname">java.york.veerbajaj.com</p>
                    <div class="flex items-center space-x-2 mt-1">
                        <span id="status-indicator" class="w-3 h-3 rounded-full bg-gray-500"></span>
                        <span id="status-text" class="text-gray-400 font-medium">Unknown</span>
                    </div>
                </div>
            </div>

            <!-- Players -->
            <div class="bg-gray-700/50 p-4 rounded-lg mb-4">
                <div class="flex justify-between items-center">
                    <span class="font-medium text-gray-300">Players</span>
                    <span id="player-count" class="font-bold text-lg text-emerald-400">0 / 0</span>
                </div>
            </div>
            
            <!-- Message of the Day (MOTD) -->
            <div class="bg-gray-900 p-4 rounded-lg font-mono text-sm leading-relaxed motd-container">
                <p class="text-gray-400 mb-2">Message of the Day:</p>
                <div id="motd" class="whitespace-pre-wrap"></div>
            </div>

            <!-- Share to Discord Button -->
            <div class="mt-5 text-center">
                <button id="discord-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center">
                    Share to Discord
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const serverHostnameElem = document.getElementById('server-hostname');
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        const serverIcon = document.getElementById('server-icon');
        const playerCount = document.getElementById('player-count');
        const motd = document.getElementById('motd');
        const refreshBtn = document.getElementById('refresh-btn');
        const refreshIcon = document.getElementById('refresh-icon');

        const loadingState = document.getElementById('loading-state');
        const errorState = document.getElementById('error-state');
        const errorMessage = document.getElementById('error-message');
        const serverContent = document.getElementById('server-content');
        const discordBtn = document.getElementById('discord-btn');

        // --- Configuration ---
        const SERVER_ADDRESS = 'java.york.veerbajaj.com';
        const API_URL = `https://api.mcsrvstat.us/2/${SERVER_ADDRESS}`;
        // WARNING: Exposing webhooks on the client-side is a security risk.
        // Anyone can find this URL and spam your channel. Use this for personal projects only.
        const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1428872358331940864/052hF-Wf-cwUqGTvQqncZj1Q5F3rzSkKztnTMMViXmN2hFG61MB7BYLw27E1vbWAOMEF';

        // --- State ---
        let currentServerData = null;

        /**
         * Fetches server status from the API and updates the UI.
         */
        async function fetchServerStatus() {
            // --- UI Reset ---
            serverContent.classList.add('hidden');
            errorState.classList.add('hidden');
            loadingState.classList.remove('hidden');
            refreshIcon.classList.add('animate-spin');
            discordBtn.disabled = true;

            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error(`API returned an error: ${response.statusText}`);
                }
                const data = await response.json();

                // Check for invalid hostname response
                if (data.online === undefined) {
                    throw new Error(`Server not found. Is '${SERVER_ADDRESS}' a valid address?`);
                }
                
                currentServerData = data; // Store the latest data
                updateDOM(data);
                
                // Show content
                loadingState.classList.add('hidden');
                serverContent.classList.remove('hidden');
                discordBtn.disabled = false;

            } catch (error) {
                console.error('Failed to fetch server status:', error);
                currentServerData = null; // Clear data on error
                displayError(error.message);
            } finally {
                refreshIcon.classList.remove('animate-spin');
            }
        }
        
        /**
         * Updates the DOM with data from the API.
         * @param {object} data - The server status data object.
         */
        function updateDOM(data) {
            serverHostnameElem.textContent = data.hostname || SERVER_ADDRESS;

            // Update status indicator and text
            if (data.online) {
                statusIndicator.classList.remove('bg-red-500', 'bg-gray-500');
                statusIndicator.classList.add('bg-emerald-500');
                statusText.textContent = 'Online';
                statusText.classList.remove('text-red-400', 'text-gray-400');
                statusText.classList.add('text-emerald-400');
            } else {
                statusIndicator.classList.remove('bg-emerald-500', 'bg-gray-500');
                statusIndicator.classList.add('bg-red-500');
                statusText.textContent = 'Offline';
                statusText.classList.remove('text-emerald-400', 'text-gray-400');
                statusText.classList.add('text-red-400');
            }
            
            // Update server icon if available
            if (data.icon) {
                serverIcon.src = data.icon;
            } else {
                 serverIcon.src = `https://placehold.co/64x64/1F2937/FFFFFF?text=${SERVER_ADDRESS.charAt(0).toUpperCase()}`;
                 serverIcon.alt = "Default Server Icon";
            }
            
            // Update player count
            playerCount.textContent = `${data.players.online} / ${data.players.max}`;
            
            // Update MOTD, using the HTML version for colors
            if (data.motd && data.motd.html) {
                // The API provides an array of HTML strings for each line
                motd.innerHTML = data.motd.html.join('<br>');
            } else {
                motd.textContent = 'No MOTD available.';
            }
        }
        
        /**
         * Displays an error message in the UI.
         * @param {string} message - The error message to display.
         */
        function displayError(message) {
            loadingState.classList.add('hidden');
            serverContent.classList.add('hidden');
            errorMessage.textContent = message;
            errorState.classList.remove('hidden');
        }

        /**
         * Sends the server status to a Discord webhook.
         */
        async function sendToDiscord() {
            if (!currentServerData) {
                console.error("No server data available to send.");
                // In a real app, you might show a more user-friendly modal here.
                alert("Please fetch server data before sharing.");
                return;
            }

            const originalButtonText = discordBtn.innerHTML;
            discordBtn.disabled = true;
            discordBtn.innerHTML = `
                <span class="flex items-center justify-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Sending...
                </span>`;

            const data = currentServerData;

            const embed = {
                title: data.hostname || SERVER_ADDRESS,
                color: data.online ? 5814783 : 15548997, // Green for online, Red for offline
                fields: [
                    { name: "Status", value: data.online ? "🟢 Online" : "🔴 Offline", inline: true },
                    { name: "Players", value: `${data.players.online} / ${data.players.max}`, inline: true }
                ],
                description: data.motd.clean.join('\n'),
                // The thumbnail URL MUST be a direct http/https link, not a base64 data URI.
                // Since the API provides a base64 string, we must omit this field.
                // thumbnail: { url: data.icon },
                timestamp: new Date().toISOString(),
                footer: { text: "Status checked via mcstat.us" }
            };

            const payload = {
                username: "Minecraft Server Monitor",
                avatar_url: "https://i.imgur.com/q4s4T4B.png", // Generic Minecraft grass block icon
                embeds: [embed]
            };

            try {
                const res = await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    throw new Error(`Discord API error: ${res.status} ${await res.text()}`);
                }
                
                discordBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                discordBtn.classList.add('bg-emerald-600');
                discordBtn.innerHTML = 'Sent Successfully!';
            } catch (error) {
                console.error("Failed to send to Discord:", error);
                discordBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                discordBtn.classList.add('bg-red-600');
                discordBtn.innerHTML = 'Error! Check Console';
            } finally {
                setTimeout(() => {
                    discordBtn.disabled = false;
                    discordBtn.innerHTML = originalButtonText;
                    discordBtn.classList.remove('bg-emerald-600', 'bg-red-600');
                    discordBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                }, 3000);
            }
        }

        // --- Event Listeners ---
        refreshBtn.addEventListener('click', fetchServerStatus);
        discordBtn.addEventListener('click', sendToDiscord);

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', fetchServerStatus);
    </script>
</body>
</html>

